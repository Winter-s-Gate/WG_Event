<html lang="fr">
	<head>
		<meta charset="UTF-8">
		<title>Ajouter un événement RP</title>
		<style>
			body { font-family: sans-serif; padding: 2.5em; background: #f9f9f9; }
			form { background: white; font-size: 2em; padding: 1em; border-radius: 8px; max-width: 400px; margin: auto; }
			label { font-size: 2em;display: block; margin-top: 1em; }
			input, button { font-size: 2em; width: 100%; padding: 0.5em; margin-top: 0.5em; }
			button { background: #4CAF50; color: white; border: none; cursor: pointer; }
			#confirmation { margin-top: 1em; text-align: center; font-weight: bold; }
		</style>
	</head>
	<body>
		<form id="eventForm">
			<h2>➕ Add event</h2>
			<label>🕒 Hours:</label>
			<input type="time" name="time" required>
			<label>📅 Date:</label>
			<input type="date" name="date" required>

			<label>🎭 Title:</label>
			<input type="text" name="title" required>

			<label>👤 Animateur:</label>
			<input type="text" name="host">

			<label>📍 Landmark:</label>
			<input type="text" name="location">

			<label>🖼️ Flyer (URL):</label>
			<input type="url" name="image">

			<label>🔁 Weekly:</label>
			<input type="checkbox" name="repeat">

			<button type="submit">📤 Send</button>
			<button type="button" onclick="cancelForm()">❌ Cancel</button>
		</form>

		<div id="confirmation"></div>

		<script>
			document.getElementById("eventForm").addEventListener("submit", function (e) {
				e.preventDefault();
				const form = e.target;
				const formData = new FormData(form);

				// Normalise la checkbox repeat
				formData.set("repeat", form.repeat.checked ? "true" : "false");

				// Ajoute l’UUID si présent dans l’URL
				const uuid = new URLSearchParams(window.location.search).get("uuid");
				if (uuid) formData.set("uuid", uuid);

				const body = new URLSearchParams(formData).toString();

				fetch("https://script.google.com/macros/s/AKfycby6pFxSTNi5Ps99GR-jMtLSOQPXmHNvt1nz_K1kcp5HnRMt59hgOJpxv8vCp-DUMDSn/exec", {
					method: "POST",
					headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
					body: body
				})
				.then(res => {
					if (!res.ok) throw new Error("response not ok");
					return res.text();
				})
				.then(msg => {
					document.getElementById("confirmation").textContent = "✅ Événement ajouté !";
					console.log("Réponse serveur:", msg);
				})
				.catch(err => {
					console.error("Erreur de soumission :", err);
					document.getElementById("confirmation").textContent = "❌ Erreur réseau ou script.";
				});
			});
		</script>
		<script>
			function cancelForm() {
				window.location.href = "index.html"; // ou window.history.back();
			}
		</script>
	</body>
</html>
