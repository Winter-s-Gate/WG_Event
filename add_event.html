<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8">
		<title>Ajouter un événement RP</title>
		<style>
			body { font-family: sans-serif; padding: 2.5em; background: #f9f9f9; }
			form { background: white; padding: 1em; border-radius: 8px; max-width: 400px; margin: auto; }
			label { display: block; margin-top: 1em; }
			input, button { width: 100%; padding: 0.5em; margin-top: 0.5em; }
			button { background: #4CAF50; color: white; border: none; cursor: pointer; }
			#confirmation { margin-top: 1em; text-align: center; font-weight: bold; }
		</style>
	</head>
	<body>
		<form id="eventForm">
			<h2>➕ Add event</h2>
			<label>🕒 Hours:</label>
			<input type="time" name="time" required>
			<label>📅 Date:</label>
			<input type="date" name="date" required>

			<label>🎭 Title:</label>
			<input type="text" name="title" required>

			<label>👤 Animateur:</label>
			<input type="text" name="host">

			<label>📍 Landmark:</label>
			<input type="text" name="location">

			<label>🖼️ Flyer (URL):</label>
			<input type="url" name="image">

			<label>🔁 Weekly:</label>
			<input type="checkbox" name="repeat">

			<button type="submit">📤 Send</button>
			<button type="button" onclick="cancelForm()">❌ Cancel</button>
		</form>

		<div id="confirmation"></div>

		<script>
			document.getElementById("eventForm").addEventListener("submit", function (e) {
				e.preventDefault();
				const data = Object.fromEntries(new FormData(e.target).entries());
				const start = new Date(`${data.date}T${data.time}`);
				const end = new Date(start.getTime() + 60 * 60 * 1000); // +1h par défaut
				data.start = start.toISOString();
				data.end = end.toISOString();
				data.repeat = !!data.repeat;
				console.log(data); // debug

				fetch("https://script.google.com/macros/s/AKfycbwzCKSnXsW3oTjP4R-mtBkhmyZVyNFJbgRJzVoykw3sGMKYuMGA6T_kwCQmmdfRy0rX/exec", {
					method: "POST",
					body: JSON.stringify(data),
					headers: { "Content-Type": "application/json" }
				})
				.then(res => res.ok ? "✅ Événement ajouté !" : "❌ Erreur lors de l'envoi.")
				.then(msg => document.getElementById("confirmation").textContent = msg)
				.catch(err => {
					console.error("Erreur de soumission :", err);
					document.getElementById("confirmation").textContent = "❌ Erreur réseau ou script.";
				});
			});
		</script>
		<script>
			function cancelForm() {
				window.location.href = "index.html"; // ou window.history.back();
			}
		</script>
	</body>
</html>
